# Ticker Synchronization Tool Usage Guide
(銘柄同期ツールの使い方)

このドキュメントは、`config/tickers.yaml`（設定ファイル）とデータベース上の`tickers`テーブルを同期するためのスクリプト `src/manage_tickers.py` の使用方法を説明します。

## 概要

このツールは双方向の同期をサポートしています：
1. **YAML -> DB**: 設定ファイルの変更をデータベースに反映する（初期データの投入や、ファイル編集後の反映）。
2. **DB -> YAML**: データベース上の変更を設定ファイルに書き出す（システムのsource of truthとしてDBを正とする場合）。

## 事前準備

プロジェクトのルートディレクトリで実行してください。
仮想環境（`.venv`）が有効になっているか、`uv`コマンドが使える状態であることを確認してください。

## 使い方

### 1. YAML から データベースへの反映 (--to-db)

`config/tickers.yaml` を編集し、その内容をデータベースに登録・更新したい場合に使用します。
新しい銘柄を追加した場合などに実行します。

```bash
uv run python src/manage_tickers.py --to-db
```
※ `uv` が使えない場合は: `.venv/bin/python src/manage_tickers.py --to-db`

**動作:**
- YAMLファイルを読み込みます。
- `public.tickers` テーブルにデータをUpsert（挿入または更新）します。
- テーブルが存在しない場合は自動作成します。

### 2. データベース から YAMLへの書き出し (--to-yaml)

データベース上のデータが最新であり、それを手元の設定ファイルに反映させたい場合に使用します。

```bash
uv run python src/manage_tickers.py --to-yaml
```
**動作:**
- データベースから全銘柄データを取得します。
- `config/tickers.yaml` を上書き保存します。
- **注意**: コメントアウトなどは保持されません。ファイルは自動生成された形式（クォート付きの文字列など）で保存されます。

## エラー時の対応

実行時にエラーが発生した場合は、以下を確認してください：
- データベース接続設定（`config/config.yaml`）が正しいか。
- データベースサーバーが起動しているか。
